{% extends "base.html" %}
{% block content %}
<div class="container mt-4">

  <h2 class="mb-4">📊 Dashboard - Overview</h2>

  <!-- Dataset -->
  <div class="card mb-4 shadow-sm">
    <div class="card-body">
      <h4>📁 Dataset</h4>
      {% if dataset_stats.error %}
        <p class="text-danger">{{ dataset_stats.error }}</p>
      {% else %}
        <div class="row text-center">
          <div class="col-md-4"><h5>Samples</h5><p class="display-6">{{ dataset_stats.n_samples }}</p></div>
          <div class="col-md-8">
            <h6>Class Distribution</h6>
            <pre>{{ dataset_stats.class_counts | tojson(indent=2) }}</pre>
          </div>
        </div>
        <div class="row mt-3">
          {% for plot in dataset_plots %}
            <div class="col-md-4 mb-3">
              <img src="{{ url_for('static', filename='plots/' ~ plot) }}" class="img-fluid rounded shadow">
            </div>
          {% endfor %}
        </div>
      {% endif %}
    </div>
  </div>

  <!-- Baseline Training -->
  <div class="card mb-4 shadow-sm">
    <div class="card-body">
      <h4>🧑‍🏫 Baseline Training</h4>
      {% if training_stats.error %}
        <p class="text-danger">{{ training_stats.error }}</p>
      {% else %}
        <div class="row text-center">
          <div class="col-md-3"><h6>Final Accuracy</h6><p class="h4">{{ training_stats.val_acc[-1] if training_stats.val_acc else "N/A" }}</p></div>
          <div class="col-md-3"><h6>Final Loss</h6><p class="h4">{{ training_stats.val_loss[-1] if training_stats.val_loss else "N/A" }}</p></div>
          <div class="col-md-3"><h6>Epochs</h6><p class="h4">{{ training_stats.epoch[-1] if training_stats.epoch else "N/A" }}</p></div>
          <div class="col-md-3"><h6>Model</h6><p class="h4">Baseline</p></div>
        </div>
        <div class="row mt-3">
          {% for plot in training_plots %}
            <div class="col-md-6 mb-3">
              <img src="{{ url_for('static', filename='plots/' ~ plot) }}" class="img-fluid rounded shadow">
            </div>
          {% endfor %}
        </div>
      {% endif %}
    </div>
  </div>

  <!-- AdvGAN Training -->
  <div class="card mb-4 shadow-sm">
    <div class="card-body">
      <h4>⚡ AdvGAN Training</h4>
      {% if advgan_stats.error %}
        <p class="text-danger">{{ advgan_stats.error }}</p>
      {% else %}
        <div class="row text-center">
          <div class="col-md-4"><h6>Final Generator Loss</h6><p class="h4">{{ advgan_stats.gen_loss[-1] if advgan_stats.gen_loss else "N/A" }}</p></div>
          <div class="col-md-4"><h6>Final Discriminator Loss</h6><p class="h4">{{ advgan_stats.disc_loss[-1] if advgan_stats.disc_loss else "N/A" }}</p></div>
          <div class="col-md-4"><h6>Final ASR</h6><p class="h4">{{ advgan_stats.asr[-1] if advgan_stats.asr else "N/A" }}</p></div>
        </div>
        <div class="row mt-3">
          {% for plot in advgan_plots %}
            <div class="col-md-6 mb-3">
              <img src="{{ url_for('static', filename='plots/' ~ plot) }}" class="img-fluid rounded shadow">
            </div>
          {% endfor %}
        </div>
      {% endif %}
    </div>
  </div>

  <!-- Attacks Evaluation -->
  <div class="card mb-4 shadow-sm">
    <div class="card-body">
      <h4>🛡 Attack Evaluation</h4>
      {% if attack_stats.error %}
        <p class="text-danger">{{ attack_stats.error }}</p>
      {% else %}
        <div class="row text-center">
          <div class="col-md-6"><h6>Clean Accuracy</h6><p class="h4">{{ attack_stats.clean_acc }}</p></div>
          <div class="col-md-6"><h6>Adversarial Accuracy</h6><p class="h4">{{ attack_stats.adv_acc }}</p></div>
        </div>
        {% if attack_stats.per_class_asr %}
        <div class="mt-3">
          <h6>Per-class Attack Success Rate</h6>
          <pre>{{ attack_stats.per_class_asr | tojson(indent=2) }}</pre>
        </div>
        {% endif %}
        <div class="row mt-3">
          {% for plot in attack_plots %}
            <div class="col-md-6 mb-3">
              <img src="{{ url_for('static', filename='plots/' ~ plot) }}" class="img-fluid rounded shadow">
            </div>
          {% endfor %}
        </div>
      {% endif %}
    </div>
  </div>

  <!-- Federated Learning -->
  <div class="card mb-4 shadow-sm">
    <div class="card-body">
      <h4>🌐 Federated Learning</h4>
      {% if federated_stats.error %}
        <p class="text-warning">{{ federated_stats.error }}</p>
      {% else %}
        <div class="row text-center">
          <div class="col-md-4"><h6>Rounds</h6><p class="h4">{{ federated_stats.round[-1] if federated_stats.round else "N/A" }}</p></div>
          <div class="col-md-4"><h6>Final Accuracy</h6><p class="h4">{{ federated_stats.global_acc[-1] if federated_stats.global_acc else "N/A" }}</p></div>
          <div class="col-md-4"><h6>Clients</h6><p class="h4">{{ federated_stats.clients if federated_stats.clients else "N/A" }}</p></div>
        </div>
        <div class="row mt-3">
          {% for plot in federated_plots %}
            <div class="col-md-6 mb-3">
              <img src="{{ url_for('static', filename='plots/' ~ plot) }}" class="img-fluid rounded shadow">
            </div>
          {% endfor %}
        </div>
      {% endif %}
    </div>
  </div>

</div>
{% endblock %}
